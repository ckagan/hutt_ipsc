---
title: "eQTL Analysis"
author: "Courtney"
date: "Wednesday, April 15, 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(plyr)
library(stringr)

all.pvals <- list.files(path = "C:/Users/Courtney/Dropbox/LCL-iPSC/GEMMA eQTLs/Hutt iPSCs/Pvals/",pattern=".imputed.1Mb.bonferroni.regressPCs.gemma.chosen.txt",full.names=T)
pvals <- llply(all.pvals, read.table)

pval.pcs.names = str_split(all.pvals,"[.]")
pval.pcs = c()
for(i in 1:length(pval.pcs.names)){
  pval.pcs[i] = str_split(pval.pcs.names[[i]][2],"PC")[[1]][2]
}
names(pvals) = pval.pcs
inder = order(as.numeric(pval.pcs))
pvals.o = pvals[inder]
pdf("eQTLHistogram.pdf")
qcounts = c()
for(i in 1:length(pvals.o)){
  qs = p.adjust(pvals.o[[i]]$V4,method="BH")
  qcount = sum(qs < 0.05)
  qcounts[i] = qcount
  print(qcount)
  hist(pvals.o[[i]]$V4,xlab="P-value",main=paste0(names(pvals.o)[i]," PCs Removed"))
}
dev.off()
pdf("eQTLCalls.pdf")
plot(as.numeric(names(pvals.o)),qcounts,xlab="Number of PCs Removed",ylab="No. of eQTLs",type="b",pch=20)
ablines = seq(0,100,10)
for(i in 1:length(ablines)){
  abline(v=ablines[i],lty="dashed",lwd=2)
}
dev.off()
```

You can also embed plots, for example:

```{r, echo=FALSE}
plot(cars)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
